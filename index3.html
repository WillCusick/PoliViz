<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>GeoJSON from live realtime data</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
<script src='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css' rel='stylesheet' />
<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>


<div id='map'></div>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoibXpoYW5nMTMiLCJhIjoiY2lndXlob3V0MGU2djRwbTNweG95aTJmaSJ9.KLbR2K5XJHPvjqZ2dU8ksQ';
var map = L.mapbox.map('map', 'mzhang13.cfaa8810')
    .setView([38.83, -96.88], 5);

var geojson = jQuery.get('https://wanderdrone.appspot.com/', function(data) {
	L.mapbox.featureLayer()
	    .setGeoJSON(data)
	    // Once this layer loads, we set a timer to load it again in a few seconds.
	    .on('ready', run)
		.on('ready', color)
	    .addTo(map);
});

// As with any other AJAX request, this technique is subject to the Same Origin Policy:
// http://en.wikipedia.org/wiki/Same_origin_policy

var featureLayer = L.mapbox.featureLayer();

function run() {
	$('.leaflet-marker-icon').fadeOut(1000);
    window.setTimeout(function() {
        featureLayer.loadURL('https://wanderdrone.appspot.com/');
		color();
    }, 1000);
}

function color(e) {
	for (var i = 0, i < geojson.length, i++) {
		if (e.layer.feature.properties['party'] == 'republican') {
			e.layer.feature.properties['marker-color'] = 'red';
		}
		else if (e.layer.feature.properties['party'] == 'democrat') {
			e.layer.feature.properties['marker-color'] = 'red';
		}
		else {
			e.layer.feature.properties['marker-color'] = 'black';
		}
	}
}
</script>


</body>
</html>
